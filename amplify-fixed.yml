version: 1
env:
  runtime: nodejs20.x  # Changed from nodejs22.x to nodejs20.x (supported by Amplify)
  variables:
    NODE_OPTIONS: "--max-old-space-size=8192"
    PUPPETEER_SKIP_DOWNLOAD: "true"
    AMPLIFY_MONOREPO_APP_ROOT: frontend
backend:
  phases:
    preBuild:
      commands: []
frontend:
  phases:
    preBuild:
      commands:
        # Install pnpm
        - corepack enable
        - corepack prepare pnpm@9.12.3 --activate
        # Install dependencies from the frontend directory
        - cd frontend && pnpm install --frozen-lockfile
    build:
      commands:
        # Build from frontend directory directly - no complex turbo prune
        - cd frontend && pnpm run build:amplify:fixed
  artifacts:
    baseDirectory: frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*
