version: 1
env:
  runtime: nodejs20.x
  variables:
    NODE_OPTIONS: "--max-old-space-size=8192"
    PUPPETEER_SKIP_DOWNLOAD: "true"
    AMPLIFY_MONOREPO_APP_ROOT: frontend
backend:
  phases:
    preBuild:
      commands: []
frontend:
  phases:
    preBuild:
      commands:
        # Install pnpm
        - corepack enable
        - corepack prepare pnpm@9.12.3 --activate
        # Install dependencies (already in frontend directory due to AMPLIFY_MONOREPO_APP_ROOT)
        - pnpm install --frozen-lockfile
    build:
      commands:
        # Build directly (already in frontend directory due to AMPLIFY_MONOREPO_APP_ROOT)
        - pnpm run build:amplify:fixed
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
