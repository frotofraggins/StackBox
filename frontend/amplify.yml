version: 1
env:
  runtime: nodejs22.x

frontend:
  phases:
    preBuild:
      commands:
        - echo "🔎 Preflight AWS account"
        - echo "Current Node version: $(node -v)"
        - nvm use 22 || echo "Node 22 already active"
        - node -v
        - node ../scripts/preflight-aws-account.js
        - corepack enable
        - corepack prepare pnpm@9.12.3 --activate
        - pnpm -v && node -v
        - cd .. && pnpm install --no-frozen-lockfile
        - cd frontend
    build:
      commands:
        - echo "🏗️ Building frontend"
        - pnpm build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .npm-cache/**/*
      - node_modules/**/*
      - ../node_modules/**/*
      - ../pnpm-store/**/*
